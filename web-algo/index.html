<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Aplicativo de programação da UCS">
  <title>C-Compiler Web</title>

  <!-- Preconnect para CDNs -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://code.jquery.com">

  <!-- Critical CSS - IntroJs e CodeMirror -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/introjs.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/introjs.min.css">
  </noscript>

  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/codemirror.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/codemirror.min.css">
  </noscript>

  <!-- Bootstrap - Critical -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <!-- Local CSS -->
  <link rel="stylesheet" href="includes/css/main.css">
  <link rel="stylesheet" href="includes/css/sidebar.css">
  <link rel="icon" type="image/png" href="includes/media/favicon-32x32.png">

  <!-- Non-critical CSS - Load async -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/theme/dracula.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/addon/hint/show-hint.min.css"
    as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    as="style" onload="this.onload=null;this.rel='stylesheet'">

  <!-- Preload jQuery -->
  <link rel="preload" href="https://code.jquery.com/jquery-3.6.0.min.js" as="script">

  <!-- Critical inline styles -->
  <style>
    .bd-placeholder-img {
      font-size: 110%;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 300%;
      }
    }

    /* Critical loading styles */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
      color: white;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container-fluid">
      <button class="btn me-2 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu"
        aria-controls="offcanvasMenu" aria-label="Menu">
        <svg viewBox="0 0 30 30" width="24" height="24" stroke="var(--text-primary)" stroke-width="2" role="img"
          aria-hidden="true">
          <path d="M4 7h22M4 15h22M4 23h22" />
        </svg>
      </button>

      <a class="navbar-brand d-none d-lg-block" href="#" aria-label="WebAlgo">WebAlgo</a>

      <div class="navbar-nav me-auto">
        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#buscarAlgoritmoModal">
          Algoritmos
          <svg class="bi" width="24" height="24" role="img" aria-label="Buscar">
            <use xlink:href="#search-icon" />
          </svg>
        </a>
        <a class="nav-link" href="#">Informações</a>
      </div>

      <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-light" id="button6" hidden onclick="retira_depuracao()">
          Continuar sem depuração
        </button>
        <button type="button" class="btn btn-success" id="button5" hidden>
          Próximo passo
        </button>

        <button class="btn btn-debug" id="button4" onclick="inicia_worker(true)">
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
            fill="currentColor" aria-hidden="true">
            <path
              d="M480-200q66 0 113-47t47-113v-160q0-66-47-113t-113-47q-66 0-113 47t-47 113v160q0 66 47 113t113 47Zm-80-120h160v-80H400v80Zm0-160h160v-80H400v80Zm80 40Zm0 320q-65 0-120.5-32T272-240H160v-80h84q-3-20-3.5-40t-.5-40h-80v-80h80q0-20 .5-40t3.5-40h-84v-80h112q14-23 31.5-43t40.5-35l-64-66 56-56 86 86q28-9 57-9t57 9l88-86 56 56-66 66q23 15 41.5 34.5T688-640h112v80h-84q3 20 3.5 40t.5 40h80v80h-80q0 20-.5 40t-3.5 40h84v80H688q-32 56-87.5 88T480-120Z" />
          </svg>
          Debug
        </button>

        <button class="btn btn-run" id="button2" onclick="inicia_worker()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M8 5v14l11-7z" />
          </svg>
          Executar
        </button>

        <button type="button" class="btn btn-danger" id="button3" onclick="cancelarExecucao()" title="Cancelar execução"
          hidden>
          Cancelar
        </button>

        <!-- User dropdown -->
        <div class="dropdown d-none d-md-flex">
          <button class="btn p-0 border-0 d-flex align-items-center" data-bs-toggle="dropdown" aria-expanded="false"
            aria-label="Menu do usuário">
            <span class="d-inline-flex justify-content-center align-items-center rounded-circle"
              style="width:32px;height:32px;background:#e9ecef;color:#212529;font-weight:600;">
              U
            </span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="ms-1"
              viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M1.5 5.5l6 6 6-6H1.5z" />
            </svg>
          </button>
          <ul class="dropdown-menu dropdown-menu-end shadow sidebar">
            <li><a class="dropdown-item nav-link-custom" id="logoutBtn" href="/web-algo/login.html">Sair</a></li>

            <li>
              <hr class="dropdown-divider">
            </li>

            <!-- Accessibility box -->
            <li class="accessibility-container-desktop">

            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Offcanvas Menu -->
  <aside class="offcanvas offcanvas-start sidebar" tabindex="-1" id="offcanvasMenu"
    aria-labelledby="offcanvasMenuLabel">
    <header class="offcanvas-header" style="display: flex; justify-content: space-between;">
      <h5 class="offcanvas-title" id="offcanvasMenuLabel">WebAlgo</h5>
      <button type="button" class="btn-close-modal" data-bs-dismiss="offcanvas" aria-label="Fechar" style="all:unset;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" stroke="var(--text-primary)" stroke-width="2"
          stroke-linecap="round" style="width: 20px; height: 20px;" aria-hidden="true">
          <path d="M6 6 L24 24 M6 24 L24 6" />
        </svg>
      </button>
    </header>

    <div class="offcanvas-body d-flex flex-column justify-content-between">
      <nav>
        <ul class="list-unstyled">
          <li>
            <a href="#" class="nav-link-custom">
              <i class="material-symbols-outlined" aria-hidden="true">login</i>
              Entrar
            </a>
          </li>
          <li>
            <a href="#" class="nav-link-custom">
              <i class="material-symbols-outlined" aria-hidden="true">dashboard</i>
              Dashboard
            </a>
          </li>
          <li>
            <a href="#" class="nav-link-custom" data-bs-toggle="modal" data-bs-target="#buscarAlgoritmoModal">
              <i class="material-symbols-outlined" aria-hidden="true">school</i>
              Exercícios
            </a>
          </li>
          <li>
            <a href="#" class="nav-link-custom">
              <i class="material-symbols-outlined" aria-hidden="true">info</i>
              Informações
            </a>
          </li>
        </ul>
      </nav>

      <footer class="text-center mt-auto">
        <div class="accessibility-container-mobile">
          <div class="accessibility-box">
            <div class="font-size-container">
              <span aria-hidden="true">a</span>
              <input type="range" id="font-size-selector" class="form-range" min="0.5" max="2" step="0.1" value="1"
                aria-label="Tamanho da fonte">
              <span aria-hidden="true">A</span>
            </div>

            <div class="theme-container form-check form-switch mt-3">
              <input class="form-check-input" type="checkbox" role="switch" id="darkModeSwitch">
              <label class="form-check-label" for="darkModeSwitch">Dark mode</label>
            </div>
          </div>
        </div>

        <img src="./includes/media/logo_ucs_horizontal.png" alt="UCS" style="max-width: 120px; margin-top: 4rem;"
          loading="lazy">
        <p class="small mt-2" style="color: var(--text-secondary);">© 2001–2025 Universidade de Caxias do Sul. Todos os
          direitos reservados.</p>
      </footer>
    </div>
  </aside>

  <!-- Main Layout -->
  <main class="main-layout">
    <!-- Left Panel -->
    <section class="left-panel">
      <div class="panel-tabs">
        <ul class="nav nav-tabs" id="leftPanelTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="questao-tab" data-bs-toggle="tab" data-bs-target="#questao"
              type="button" role="tab" aria-controls="questao" aria-selected="true">
              Questão
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="variaveis-tab" data-bs-toggle="tab" data-bs-target="#variaveis" type="button"
              role="tab" aria-controls="variaveis" aria-selected="false">
              Variáveis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="c3e-tab" data-bs-toggle="tab" data-bs-target="#c3e" type="button" role="tab"
              aria-controls="c3e" aria-selected="false" onclick="exibe_c3e()">
              C3E
            </button>
          </li>
          <li class="nav-item d-md-none" role="presentation">
            <button class="nav-link" id="codigo-tab" data-bs-toggle="tab" data-bs-target="#codigo" type="button"
              role="tab" aria-controls="codigo" aria-selected="false">
              Código
            </button>
          </li>
        </ul>
      </div>

      <div class="tab-content flex-fill">
        <!-- Questão Tab -->
        <div class="tab-pane fade show active" id="questao" role="tabpanel" aria-labelledby="questao-tab">
          <div class="question-content">
            <div class="mb-3">
              <div class="row g-2 align-items-center">
                <div class="col-auto">
                  <label for="solucoes" class="form-label mb-0">Soluções:</label>
                </div>
                <div class="col-12 col-md-auto">
                  <select id="solucoes" class="form-select">
                    <option value="">Nenhum encontrado</option>
                  </select>
                </div>
                <div class="col-12 col-md-auto d-flex flex-wrap gap-1">
                  <button id="btnCriarSol"
                    class="btn btn-primary btn-sm flex-fill flex-md-none d-flex align-items-center gap-1 justify-content-center"><svg
                      width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>Criar</button>
                  <button id="btnSalvarSol"
                    class="btn btn-success btn-sm flex-fill flex-md-none d-flex align-items-center gap-1 justify-content-center"><svg
                      width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path
                        d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z" />
                    </svg>Salvar</button>
                  <button id="btnCarregarSol"
                    class="btn btn-secondary btn-sm flex-fill flex-md-none d-flex align-items-center gap-1 justify-content-center"><svg
                      width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z" />
                    </svg>Carregar</button>
                </div>
              </div>
            </div>


            <div class="question-title" id="question">
            </div>

            <div class="example-section">
              <h6>Exemplo de entrada</h6>
              <div class="example-text"><br></div>
            </div>

            <div class="example-section">
              <h6>Exemplo de saída</h6>
              <div class="example-text"></div>
            </div>
          </div>
        </div>

        <!-- Variáveis Tab -->
        <div class="tab-pane fade" id="variaveis" role="tabpanel" aria-labelledby="variaveis-tab">
          <div class="variables-content">
            <div style="margin-bottom: 1rem;">
              <a href="#" onclick="carrega_historico_variaveis(); return false;"
                style="color: var(--accent-green); text-decoration: none;">
                Exibir histórico de variáveis
              </a>
            </div>
            <table class="table variables-table" id="tabela_variaveis">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Variável</th>
                  <th scope="col" style="text-align: right;">Valor</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="3" style="text-align: center; color: var(--text-secondary);">
                    Nenhuma variável encontrada
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- C3E Tab -->
        <div class="tab-pane fade" id="c3e" role="tabpanel" aria-labelledby="c3e-tab">
          <div class="c3e-content" id="c3eContent">
            <div id="id_p_c3e" style="color: var(--text-secondary); text-align: center; padding: 2rem;">
              Execute o código para gerar o C3E
            </div>
          </div>
        </div>

        <!-- Mobile Código Tab -->
        <div class="tab-pane fade d-md-none mobile-code-container" id="codigo" role="tabpanel"
          aria-labelledby="codigo-tab"></div>
      </div>
    </section>

    <!-- Right Panel -->
    <section class="right-panel d-none d-md-flex">
      <div class="desktop-right-layout"></div>
    </section>

    <!-- Code Editor Container -->
    <div id="code-container" class="code-editor-container">
      <textarea id="code" aria-label="Editor de código">/* Compilador WebAlgo Web */
int main(){
    /* Desenvolva seu código C aqui! */
    return 0;
}</textarea>
    </div>

    <!-- Console Container -->
    <div id="console-container" class="console-container">
      <textarea class="console-output" id="displayText" readonly
        aria-label="Saída do console">Pronto para executar...</textarea>
      <input type="text" id="inputText" class="console-input" placeholder="Digite aqui..." disabled
        aria-label="Entrada de dados">
    </div>
  </main>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="tela_aguarde" role="status" aria-label="Compilando">
    <div class="loading-spinner" aria-hidden="true"></div>
    <div>Compilando...</div>
    <button type="button" class="btn btn-outline-danger" onclick="cancelarExecucao()">Cancelar</button>
  </div>

  <!-- Modal Selecionar Algoritmo -->
  <div class="modal fade" id="buscarAlgoritmoModal" tabindex="-1" aria-labelledby="buscarAlgoritmoLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="buscarAlgoritmoLabel">Selecionar o algoritmo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"
            style="filter: invert(1);"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label for="tipoAlgoritmo" class="form-label">Tipo</label>
            <select class="form-select" id="tipoAlgoritmo">
              <option selected>Sequencial</option>
              <option>Condicional</option>
              <option>Iterativo</option>
              <option>Vetores</option>
              <option>Matrizes</option>
              <option>Funções</option>
              <option>Recursividade</option>
              <option>Geral</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="problemas" class="form-label">Problema</label>
            <select class="form-select" id="problemas">
              <option></option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary">Carregar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Histórico de Variáveis -->
  <div class="modal fade" id="modal_historico_variaveis" tabindex="-1" aria-labelledby="historicoVariaveisLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="historicoVariaveisLabel">Histórico de Variáveis</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"
            style="filter: invert(1);"></button>
        </div>
        <div class="modal-body">
          <table class="table variables-table" id="tabela_historico_variaveis_modal">
            <thead>
              <tr>
                <th scope="col" style="text-align: center">#</th>
                <th scope="col">Variável</th>
                <th scope="col" style="text-align: right; padding-right: 15px;">
                  Histórico (do mais antigo para o mais recente)
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="3" style="text-align: center; color: var(--text-secondary);">
                  Nenhum histórico disponível
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts - Load in optimal order -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Critical scripts -->
  <script>
    // Inline critical functions
    function mostra_tela_aguarde(msg) {
      "use strict";
      if (msg == undefined) msg = '';
      const aguardeEl = document.getElementById('tela_aguarde');
      if (aguardeEl) aguardeEl.style.display = 'flex';
    }

    function esconde_tela_aguarde() {
      "use strict";
      const aguardeEl = document.getElementById('tela_aguarde');
      if (aguardeEl) aguardeEl.style.display = 'none';
    }

    // Performance optimizations
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');

    // Debounced functions
    const debounce = (func, wait) => {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    };

    // Optimized save/restore functions
    function saveDataAndReload(reload = true) {
      if (typeof editor !== 'undefined' && editor.getValue) {
        localStorage.setItem('codigo_fonte', editor.getValue());
      }
      if (reload) location.reload();
    }

    function restoreData() {
      const codigo_fonte = localStorage.getItem('codigo_fonte');
      if (codigo_fonte && typeof editor !== 'undefined' && editor.setValue) {
        editor.setValue(codigo_fonte);
      }
    }

    function fecha_modal(id_modal) {
      const modalEl = document.getElementById(id_modal);
      if (modalEl && typeof bootstrap !== 'undefined') {
        const modal = bootstrap.Modal.getInstance(modalEl);
        if (modal) modal.hide();
      }
    }

    // Generate unique client ID
    if (!localStorage.getItem('clientId')) {
      localStorage.setItem('clientId', crypto.randomUUID());
    }
    const clientId = localStorage.getItem('clientId');

    // Optimized breakpoint management
    let lista_breakpoints = [];

    // Utility functions
    function retira_depuracao() { return true; }
    function cancelarExecucao() { saveDataAndReload(); }
    function exibe_c3e() {
      if (typeof dic_control !== 'undefined' && 'c3e' in dic_control && dic_control['c3e']) {
        const c3eEl = document.getElementById('id_p_c3e');
        if (c3eEl) c3eEl.innerText = dic_control['c3e'];
      }
    }

    function indentarTodoCodigo() {
      if (typeof editor !== 'undefined' && editor.lineCount) {
        const totalLinhas = editor.lineCount();
        for (let i = 0; i < totalLinhas; i++) {
          editor.indentLine(i, "smart");
        }
      }
    }
  </script>

  <!-- Load non-critical scripts with defer -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/intro.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/codemirror.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/mode/clike/clike.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/addon/edit/closebrackets.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/addon/hint/show-hint.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/addon/hint/anyword-hint.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"
    defer></script>

  <!-- Google tag (gtag.js) -->
  <script defer src="https://www.googletagmanager.com/gtag/js?id=G-6WDKCMCM9P"></script>
  <script defer>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-6WDKCMCM9P');
  </script>

  <!-- Local scripts -->
  <script src="includes/js/main.js" defer></script>
  <script src="includes/js/resize.js" defer></script>
  <script src="includes/js/tuor.js" defer></script>
  <script src="includes/js/theme.js" defer></script>

  <!-- Initialize after DOM and scripts load -->
  <script defer>
    var inputElement = document.getElementById('inputText');
    var textareaElement = document.getElementById('displayText');

    document.addEventListener('DOMContentLoaded', function () {
      // Initialize tooltips after Bootstrap loads
      setTimeout(() => {
        if (typeof bootstrap !== 'undefined') {
          const tooltipList = [...document.querySelectorAll('[data-bs-toggle="tooltip"]')]
            .map(el => new bootstrap.Tooltip(el));
        }
      }, 100);

      window.editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        mode: "text/x-csrc",
        theme: "default",
        autoCloseBrackets: true,
        indentUnit: 4,
        tabSize: 4,
        extraKeys: {
          "Ctrl-Space": "autocomplete",
          "Ctrl-L": indentarTodoCodigo
        }
      });

      // Breakpoint handling
      editor.on("gutterClick", function (cm, linha) {
        const lineInfo = cm.lineInfo(linha);
        if (lineInfo.text.replace(' ', '') !== '') {
          if (!lineInfo.gutterMarkers) {
            const marker = document.createElement("div");
            marker.style.color = "#822";
            marker.innerHTML = "●";
            cm.setGutterMarker(linha, "CodeMirror-linenumbers", marker);
            lista_breakpoints.push(linha + 1);
          } else {
            cm.setGutterMarker(linha, "CodeMirror-linenumbers", null);
            const index = lista_breakpoints.indexOf(linha + 1);
            if (index !== -1) lista_breakpoints.splice(index, 1);
          }
        }
      });



      // Auto-complete setup
      CodeMirror.registerHelper("hint", "c", function (editor) {
        const completions = [
          "break", "case", "char", "continue", "do", "double", "else",
          "float", "for", "goto", "if", "int", "long", "return",
          "sizeof", "switch", "void", "while"
        ];
        const cur = editor.getCursor();
        const token = editor.getTokenAt(cur);
        const start = token.start, end = cur.ch;
        const prefix = token.string;
        const list = completions.filter(c => c.startsWith(prefix));
        return {
          list: list,
          from: CodeMirror.Pos(cur.line, start),
          to: CodeMirror.Pos(cur.line, end)
        };
      });

      // Restore data after editor is ready
      restoreData();

      // Theme and font size controls
      const fontRange = document.getElementById('font-size-selector');
      const themeSwitch = document.getElementById('darkModeSwitch');

      if (fontRange) {
        fontRange.addEventListener('input', debounce(() => {
          document.body.style.fontSize = `${fontRange.value}rem`;
          localStorage.setItem('fontSize', fontRange.value);
        }, 100));

        // Restore font size
        const savedFontSize = localStorage.getItem('fontSize');
        if (savedFontSize) {
          fontRange.value = savedFontSize;
          document.body.style.fontSize = `${savedFontSize}rem`;
        }
      }

      if (themeSwitch) {
        const aplicarTema = (theme) => {
          document.body.classList.toggle('dark-mode', theme === 'dark');
          if (typeof editor !== 'undefined' && editor.setOption) {
            editor.setOption('theme', theme === 'dark' ? 'dracula' : 'default');
          }
          localStorage.setItem('theme', theme);
        };

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        aplicarTema(savedTheme);
        themeSwitch.checked = savedTheme === 'dark';

        themeSwitch.addEventListener('change', () => {
          aplicarTema(themeSwitch.checked ? 'dark' : 'light');
        });
      }

      // Input validation for numeric console input
      const inputText = document.getElementById('inputText');
      if (inputText) {
        inputText.addEventListener('input', function (e) {
          const validPattern = /^-?[0-9]*\.?[0-9]*$/;
          if (!validPattern.test(this.value)) {
            this.value = this.value.slice(0, -1);
          }
          const firstChar = this.value.charAt(0);
          if ((this.value.match(/\./g) || []).length > 1 ||
            (this.value.match(/-/g) || []).length > 1 ||
            (firstChar === '-' && this.value.charAt(1) === '.')) {
            this.value = this.value.slice(0, -1);
          }
        });
      }

      // Tour initialization
      const hasSeenTour = localStorage.getItem('hasSeenTour');
      if (!hasSeenTour && typeof startAdvancedTour === 'function') {
        setTimeout(() => {
          startAdvancedTour();
          localStorage.setItem('hasSeenTour', 'true');
        }, 1000);
      }
    });

    // Window load event for final initialization
    window.addEventListener('load', function () {
      // Restore data one more time after everything is loaded
      setTimeout(restoreData, 300);
    });
  </script>

  <!-- Module scripts for authentication and problems -->
  <script type="module">
    // Lazy load auth check
    try {
      const { isAuthenticated } = await import('./includes/js/auth/auth.js');
      // if (!isAuthenticated()) location.replace('login.html');
    } catch (e) {
      console.warn('Auth module not available:', e);
    }
  </script>

  <script type="module" src="includes/js/auth/appGuard.js"></script>

  <script type="module">
    // Lazy load problems UI
    setTimeout(async () => {
      try {
        const { initProblemsUI } = await import('./includes/js/problem/problem.js');
        initProblemsUI({ autoLoadOnStart: false });
      } catch (e) {
        console.warn('Problems module not available:', e);
      }
    }, 1500);
  </script>

  <!-- Service Worker for caching (optional) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('SW registered'))
          .catch(err => console.log('SW registration failed'));
      });
    }
  </script>

  <script type="module">
    import { initProblemsUI } from './includes/js/problem/problem.js';
    document.addEventListener('DOMContentLoaded', () => {
      initProblemsUI({
        autoLoadOnStart: true,
        fetchDefaultOnOpen: true,
        defaultCode: 'S00000050'
      });
    });
  </script>

  <script type="module">
    import { initSolutionsUI } from './includes/js/solution/solutions.js';
    initSolutionsUI({ selectId: 'solucoes', loadBtnId: 'btnCarregarSol' });
  </script>

</body>

</html>